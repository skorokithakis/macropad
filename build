#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR/.zmk"

docker run --rm \
  -v "$SCRIPT_DIR:$SCRIPT_DIR" \
  -v "$(pwd):/zmk-workspace" \
  -w /zmk-workspace \
  zmkfirmware/zmk-dev-arm:stable \
  /bin/bash -c "git config --global --add safe.directory '*' && west update && west zephyr-export && west build -s zmk/app -b nice_nano_v2 -p -- -DSHIELD=macropad -DZMK_CONFIG=$SCRIPT_DIR"

echo "Firmware built: $SCRIPT_DIR/.zmk/build/zephyr/zmk.uf2"
